sample_response = {'ret_code': 0, 'ret_msg': 'OK', 'ext_code': '', 'ext_info': '', 'result': [{'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582985700, 'open': '8618.5', 'high': '8624.5', 'low': '8610', 'close': '8614', 'volume': '134184', 'turnover': '15.576462809999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582986000, 'open': '8614', 'high': '8622', 'low': '8602.5', 'close': '8611.5', 'volume': '213430', 'turnover': '24.7801343'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582986300, 'open': '8611.5', 'high': '8618', 'low': '8605.5', 'close': '8612.5', 'volume': '278913', 'turnover': '32.38955213999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582986600, 'open': '8612.5', 'high': '8640.5', 'low': '8610', 'close': '8632.5', 'volume': '252924', 'turnover': '29.32230796'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582986900, 'open': '8632.5', 'high': '8632.5', 'low': '8615.5', 'close': '8618', 'volume': '153419', 'turnover': '17.7854343'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582987200, 'open': '8618', 'high': '8623.5', 'low': '8617.5', 'close': '8622.5', 'volume': '158989', 'turnover': '18.445238699999983'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582987500, 'open': '8622.5', 'high': '8628.5', 'low': '8594.5', 'close': '8595.5', 'volume': '288269', 'turnover': '33.47494837'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582987800, 'open': '8595.5', 'high': '8627.5', 'low': '8595.5', 'close': '8627.5', 'volume': '244177', 'turnover': '28.35235234000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582988100, 'open': '8627.5', 'high': '8628.5', 'low': '8625', 'close': '8628.5', 'volume': '5246', 'turnover': '0.6080193700000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582988400, 'open': '8628.5', 'high': '8629', 'low': '8620.5', 'close': '8621', 'volume': '259382', 'turnover': '30.06230109'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582988700, 'open': '8621', 'high': '8621', 'low': '8611', 'close': '8611', 'volume': '111549', 'turnover': '12.945186170000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582989000, 'open': '8611', 'high': '8625.5', 'low': '8611', 'close': '8623.5', 'volume': '138243', 'turnover': '16.045803739999993'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582989300, 'open': '8623.5', 'high': '8628', 'low': '8612', 'close': '8622', 'volume': '211074', 'turnover': '24.47350030000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582989600, 'open': '8622', 'high': '8664.5', 'low': '8619', 'close': '8664', 'volume': '295077', 'turnover': '34.16644236'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582989900, 'open': '8664', 'high': '8678', 'low': '8652.5', 'close': '8663', 'volume': '207824', 'turnover': '23.984682799999987'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582990200, 'open': '8663', 'high': '8671.5', 'low': '8654.5', 'close': '8658.5', 'volume': '325660', 'turnover': '37.60120609000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582990500, 'open': '8658.5', 'high': '8663', 'low': '8658', 'close': '8658', 'volume': '419838', 'turnover': '48.48703269'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582990800, 'open': '8658', 'high': '8665.5', 'low': '8646.5', 'close': '8665', 'volume': '262909', 'turnover': '30.38776051000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582991100, 'open': '8665', 'high': '8690', 'low': '8665', 'close': '8689', 'volume': '441971', 'turnover': '50.89863812000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582991400, 'open': '8689', 'high': '8689', 'low': '8671.5', 'close': '8679.5', 'volume': '168676', 'turnover': '19.421360090000007'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582991700, 'open': '8679.5', 'high': '8679.5', 'low': '8667.5', 'close': '8673.5', 'volume': '213480', 'turnover': '24.6043863'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582992000, 'open': '8673.5', 'high': '8679', 'low': '8639', 'close': '8653', 'volume': '306567', 'turnover': '35.35386637'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582992300, 'open': '8653', 'high': '8658', 'low': '8646', 'close': '8646', 'volume': '276121', 'turnover': '31.921071580000014'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582992600, 'open': '8646', 'high': '8657', 'low': '8645', 'close': '8653', 'volume': '305913', 'turnover': '35.35735905999996'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582992900, 'open': '8653', 'high': '8671', 'low': '8653', 'close': '8668.5', 'volume': '233897', 'turnover': '27.01220338'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582993200, 'open': '8668.5', 'high': '8675', 'low': '8657', 'close': '8665', 'volume': '218893', 'turnover': '25.259017299999996'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582993500, 'open': '8665', 'high': '8665', 'low': '8652', 'close': '8659', 'volume': '146677', 'turnover': '16.94399903999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582993800, 'open': '8659', 'high': '8659', 'low': '8645', 'close': '8645', 'volume': '158709', 'turnover': '18.34113428000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582994100, 'open': '8645', 'high': '8645', 'low': '8630.5', 'close': '8630.5', 'volume': '185123', 'turnover': '21.437798770000008'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582994400, 'open': '8630.5', 'high': '8635.5', 'low': '8625.5', 'close': '8635.5', 'volume': '140123', 'turnover': '16.232032599999993'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582994700, 'open': '8635.5', 'high': '8640', 'low': '8626.5', 'close': '8640', 'volume': '144777', 'turnover': '16.774377050000002'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582995000, 'open': '8640', 'high': '8642', 'low': '8627', 'close': '8628.5', 'volume': '56175', 'turnover': '6.50108013'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582995300, 'open': '8628.5', 'high': '8628.5', 'low': '8619', 'close': '8621.5', 'volume': '462892', 'turnover': '53.67501671999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582995600, 'open': '8621.5', 'high': '8627', 'low': '8611', 'close': '8627', 'volume': '110207', 'turnover': '12.789681379999994'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582995900, 'open': '8627', 'high': '8641', 'low': '8627', 'close': '8639', 'volume': '244675', 'turnover': '28.32631949'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582996200, 'open': '8639', 'high': '8649', 'low': '8638.5', 'close': '8649', 'volume': '169216', 'turnover': '19.57533765999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582996500, 'open': '8649', 'high': '8649', 'low': '8635.5', 'close': '8647.5', 'volume': '246165', 'turnover': '28.490420330000006'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582996800, 'open': '8647.5', 'high': '8656.5', 'low': '8647.5', 'close': '8656', 'volume': '174395', 'turnover': '20.15766988000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582997100, 'open': '8656', 'high': '8666', 'low': '8656', 'close': '8659.5', 'volume': '211447', 'turnover': '24.421205860000008'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582997400, 'open': '8659.5', 'high': '8659.5', 'low': '8648.5', 'close': '8653', 'volume': '130464', 'turnover': '15.079553030000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582997700, 'open': '8653', 'high': '8665', 'low': '8650', 'close': '8658.5', 'volume': '308062', 'turnover': '35.59419934'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582998000, 'open': '8658.5', 'high': '8661.5', 'low': '8653', 'close': '8661', 'volume': '105381', 'turnover': '12.172848279999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582998300, 'open': '8661', 'high': '8663.5', 'low': '8658.5', 'close': '8658.5', 'volume': '59016', 'turnover': '6.815719509999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582998600, 'open': '8658.5', 'high': '8671', 'low': '8658', 'close': '8661', 'volume': '241856', 'turnover': '27.92221653999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582998900, 'open': '8661', 'high': '8666', 'low': '8657.5', 'close': '8665.5', 'volume': '109226', 'turnover': '12.605074709999993'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582999200, 'open': '8665.5', 'high': '8665.5', 'low': '8662.5', 'close': '8665.5', 'volume': '73382', 'turnover': '8.469607220000004'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582999500, 'open': '8665.5', 'high': '8665.5', 'low': '8659', 'close': '8659', 'volume': '221037', 'turnover': '25.51500382'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1582999800, 'open': '8659', 'high': '8659.5', 'low': '8657', 'close': '8659.5', 'volume': '204782', 'turnover': '23.650642499999986'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583000100, 'open': '8659.5', 'high': '8678.5', 'low': '8659.5', 'close': '8678', 'volume': '255222', 'turnover': '29.425938619999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583000400, 'open': '8678', 'high': '8688', 'low': '8678', 'close': '8688', 'volume': '293655', 'turnover': '33.82668352'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583000700, 'open': '8688', 'high': '8689', 'low': '8677.5', 'close': '8685.5', 'volume': '262998', 'turnover': '30.29498059000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583001000, 'open': '8685.5', 'high': '8686.5', 'low': '8676', 'close': '8681', 'volume': '121970', 'turnover': '14.04938158'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583001300, 'open': '8681', 'high': '8682.5', 'low': '8672', 'close': '8672', 'volume': '275553', 'turnover': '31.74772698'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583001600, 'open': '8672', 'high': '8672', 'low': '8671.5', 'close': '8672', 'volume': '15544', 'turnover': '1.7924388599999996'}, {'symbol': 'BTCUSD', 'interval': '5',
    'open_time': 1583001900, 'open': '8672', 'high': '8683.5', 'low': '8671', 'close': '8683.5', 'volume': '85667', 'turnover': '9.87238001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583002200, 'open': '8683.5', 'high': '8688', 'low': '8683', 'close': '8688', 'volume': '12257', 'turnover': '1.41087659'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583002500, 'open': '8688', 'high': '8688.5', 'low': '8677.5', 'close': '8678', 'volume': '315863', 'turnover': '36.37845602'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583002800, 'open': '8678', 'high': '8678', 'low': '8667.5', 'close': '8667.5', 'volume': '271474', 'turnover': '31.2964693'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583003100, 'open': '8667.5', 'high': '8675', 'low': '8665', 'close': '8666', 'volume': '288498', 'turnover': '33.278590749999985'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583003400, 'open': '8666', 'high': '8667', 'low': '8666', 'close': '8667', 'volume': '256824', 'turnover': '29.632404680000015'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583003700, 'open': '8667', 'high': '8667.5', 'low': '8666.5', 'close': '8667', 'volume': '249061', 'turnover': '28.737026230000016'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583004000, 'open': '8667', 'high': '8669', 'low': '8667', 'close': '8669', 'volume': '232576', 'turnover': '26.834651230000002'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583004300, 'open': '8669', 'high': '8669', 'low': '8650', 'close': '8650', 'volume': '360723', 'turnover': '41.67297269'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583004600, 'open': '8650', 'high': '8653.5', 'low': '8650', 'close': '8653.5', 'volume': '171973', 'turnover': '19.874771899999995'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583004900, 'open': '8653.5', 'high': '8657', 'low': '8653', 'close': '8657', 'volume': '342294', 'turnover': '39.548346429999974'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583005200, 'open': '8657', 'high': '8681.5', 'low': '8657', 'close': '8681.5', 'volume': '122563', 'turnover': '14.13704941'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583005500, 'open': '8681.5', 'high': '8686.5', 'low': '8681.5', 'close': '8686.5', 'volume': '338437', 'turnover': '38.96128315'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583005800, 'open': '8686.5', 'high': '8694.5', 'low': '8686.5', 'close': '8694', 'volume': '387704', 'turnover': '44.59507795000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583006100, 'open': '8694', 'high': '8694', 'low': '8686', 'close': '8690', 'volume': '256271', 'turnover': '29.502113710000017'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583006400, 'open': '8690', 'high': '8690.5', 'low': '8676.5', 'close': '8682', 'volume': '95220', 'turnover': '10.968056300000008'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583006700, 'open': '8682', 'high': '8682', 'low': '8675', 'close': '8675.5', 'volume': '88899', 'turnover': '10.24627281'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583007000, 'open': '8675.5', 'high': '8686.5', 'low': '8675', 'close': '8686', 'volume': '344224', 'turnover': '39.64258106999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583007300, 'open': '8686', 'high': '8686', 'low': '8676', 'close': '8676', 'volume': '13231', 'turnover': '1.5244248899999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583007600, 'open': '8676', 'high': '8676', 'low': '8663.5', 'close': '8663.5', 'volume': '273942', 'turnover': '31.607094870000005'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583007900, 'open': '8663.5', 'high': '8663.5', 'low': '8659', 'close': '8659.5', 'volume': '387788', 'turnover': '44.776769339999994'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583008200, 'open': '8659.5', 'high': '8665.5', 'low': '8658.5', 'close': '8665', 'volume': '387233', 'turnover': '44.710106190000005'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583008500, 'open': '8665', 'high': '8667.5', 'low': '8665', 'close': '8666', 'volume': '52562', 'turnover': '6.065782740000006'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583008800, 'open': '8666', 'high': '8673.5', 'low': '8666', 'close': '8673.5', 'volume': '223352', 'turnover': '25.76587518000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583009100, 'open': '8673.5', 'high': '8673.5', 'low': '8662', 'close': '8662', 'volume': '183364', 'turnover': '21.14214386000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583009400, 'open': '8662', 'high': '8662', 'low': '8657', 'close': '8658.5', 'volume': '319798', 'turnover': '36.93649162000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583009700, 'open': '8658.5', 'high': '8665.5', 'low': '8658.5', 'close': '8665', 'volume': '188711', 'turnover': '21.78521081999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583010000, 'open': '8665', 'high': '8670.5', 'low': '8665', 'close': '8667.5', 'volume': '253302', 'turnover': '29.227743649999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583010300, 'open': '8667.5', 'high': '8672.5', 'low': '8667', 'close': '8671.5', 'volume': '160626', 'turnover': '18.53027742'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583010600, 'open': '8671.5', 'high': '8671.5', 'low': '8657', 'close': '8659.5', 'volume': '125312', 'turnover': '14.457633289999993'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583010900, 'open': '8659.5', 'high': '8659.5', 'low': '8628.5', 'close': '8632.5', 'volume': '137364', 'turnover': '15.86652146'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583011200, 'open': '8632.5', 'high': '8634.5', 'low': '8625.5', 'close': '8634.5', 'volume': '147543', 'turnover': '17.09151821'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583011500, 'open': '8634.5', 'high': '8634.5', 'low': '8624', 'close': '8627.5', 'volume': '423326', 'turnover': '49.07095706999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583011800, 'open': '8627.5', 'high': '8631.5', 'low': '8627.5', 'close': '8631', 'volume': '140178', 'turnover': '16.244830760000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583012100, 'open': '8631', 'high': '8638.5', 'low': '8631', 'close': '8638', 'volume': '374110', 'turnover': '43.325709110000005'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583012400, 'open': '8638', 'high': '8638', 'low': '8637.5', 'close': '8637.5', 'volume': '204162', 'turnover': '23.636653149999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583012700, 'open': '8637.5', 'high': '8637.5', 'low': '8622.5', 'close': '8623', 'volume': '213747', 'turnover': '24.776308949999983'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583013000, 'open': '8623', 'high': '8637.5', 'low': '8623', 'close': '8637.5', 'volume': '54448', 'turnover': '6.3083689000000005'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583013300, 'open': '8637.5', 'high': '8639.5', 'low': '8637.5', 'close': '8639', 'volume': '396883', 'turnover': '45.94255026999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583013600, 'open': '8639', 'high': '8642', 'low': '8638', 'close': '8639.5', 'volume': '101200', 'turnover': '11.710453580000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583013900, 'open': '8639.5', 'high': '8639.5', 'low': '8633.5', 'close': '8633.5', 'volume': '374695', 'turnover': '43.38586375000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583014200, 'open': '8633.5', 'high': '8633.5', 'low': '8623.5', 'close': '8623.5', 'volume': '257649', 'turnover': '29.852208850000007'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583014500, 'open': '8623.5', 'high': '8623.5', 'low': '8604.5', 'close': '8606', 'volume': '185197', 'turnover': '21.491326119999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583014800, 'open': '8606', 'high': '8617', 'low': '8605.5', 'close': '8610', 'volume': '336885', 'turnover': '39.1054977'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583015100, 'open': '8610', 'high': '8612.5', 'low': '8609', 'close': '8612', 'volume': '235470', 'turnover': '27.34443012000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583015400, 'open': '8612', 'high': '8627.5', 'low': '8612', 'close': '8627.5', 'volume': '159238', 'turnover': '18.48150195'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583015700, 'open': '8627.5', 'high': '8633', 'low': '8627', 'close': '8631.5', 'volume': '49290', 'turnover': '5.711777859999998'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583016000, 'open': '8631.5', 'high': '8633.5', 'low': '8631.5', 'close': '8632.5', 'volume': '331156', 'turnover': '38.362130779999994'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583016300, 'open': '8632.5', 'high': '8632.5', 'low': '8621.5', 'close': '8621.5', 'volume': '194014', 'turnover': '22.489307730000004'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583016600, 'open': '8621.5', 'high': '8636', 'low': '8621.5', 'close': '8636', 'volume': '232610', 'turnover': '26.946583919999988'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583016900, 'open': '8636', 'high': '8637.5', 'low': '8634.5', 'close': '8637', 'volume': '337662', 'turnover': '39.104344999999995'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583017200, 'open': '8637', 'high': '8665', 'low': '8637', 'close': '8664.5', 'volume': '190476', 'turnover': '22.022012430000004'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583017500, 'open': '8664.5', 'high': '8665', 'low': '8648', 'close': '8648', 'volume': '314076', 'turnover': '36.30648698000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583017800, 'open': '8648', 'high': '8652.5', 'low': '8646', 'close': '8647', 'volume': '120731', 'turnover': '13.95913071'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583018100, 'open': '8647', 'high': '8647',
    'low': '8643.5', 'close': '8643.5', 'volume': '180811', 'turnover': '20.916574420000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583018400, 'open': '8643.5', 'high': '8654.5', 'low': '8643.5', 'close': '8651', 'volume': '145270', 'turnover': '16.79437974'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583018700, 'open': '8651', 'high': '8651', 'low': '8632.5', 'close': '8633', 'volume': '323404', 'turnover': '37.444057069999985'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583019000, 'open': '8633', 'high': '8635.5', 'low': '8611', 'close': '8611', 'volume': '154849', 'turnover': '17.95865194'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583019300, 'open': '8611', 'high': '8616.5', 'low': '8565.5', 'close': '8565.5', 'volume': '355139', 'turnover': '41.347428790000016'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583019600, 'open': '8565.5', 'high': '8575', 'low': '8565.5', 'close': '8570.5', 'volume': '253428', 'turnover': '29.566281200000002'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583019900, 'open': '8570.5', 'high': '8584', 'low': '8560', 'close': '8560', 'volume': '334495', 'turnover': '38.99817346'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583020200, 'open': '8560', 'high': '8570.5', 'low': '8544.5', 'close': '8558.5', 'volume': '334995', 'turnover': '39.159344439999984'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583020500, 'open': '8558.5', 'high': '8559', 'low': '8533.5', 'close': '8534', 'volume': '148909', 'turnover': '17.43143958'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583020800, 'open': '8534', 'high': '8568', 'low': '8525.5', 'close': '8567.5', 'volume': '376722', 'turnover': '44.03466610000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583021100, 'open': '8567.5', 'high': '8607', 'low': '8567.5', 'close': '8599.5', 'volume': '222753', 'turnover': '25.95004023000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583021400, 'open': '8599.5', 'high': '8600', 'low': '8583', 'close': '8584.5', 'volume': '435653', 'turnover': '50.714286129999984'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583021700, 'open': '8584.5', 'high': '8604', 'low': '8584', 'close': '8601', 'volume': '321225', 'turnover': '37.37986717999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583022000, 'open': '8601', 'high': '8605', 'low': '8588', 'close': '8594', 'volume': '255677', 'turnover': '29.746347240000002'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583022300, 'open': '8594', 'high': '8612.5', 'low': '8592.5', 'close': '8612.5', 'volume': '231476', 'turnover': '26.881409530000006'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583022600, 'open': '8612.5', 'high': '8612.5', 'low': '8600', 'close': '8605', 'volume': '339420', 'turnover': '39.44044200999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583022900, 'open': '8605', 'high': '8605', 'low': '8574', 'close': '8575.5', 'volume': '265509', 'turnover': '30.943227329999985'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583023200, 'open': '8575.5', 'high': '8576', 'low': '8559.5', 'close': '8559.5', 'volume': '239112', 'turnover': '27.893355949999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583023500, 'open': '8559.5', 'high': '8559.5', 'low': '8537', 'close': '8544', 'volume': '184904', 'turnover': '21.640697949999996'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583023800, 'open': '8544', 'high': '8561.5', 'low': '8544', 'close': '8558', 'volume': '68136', 'turnover': '7.96043761'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583024100, 'open': '8558', 'high': '8558', 'low': '8539.5', 'close': '8546', 'volume': '288589', 'turnover': '33.78807599'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583024400, 'open': '8546', 'high': '8549.5', 'low': '8525.5', 'close': '8549.5', 'volume': '181959', 'turnover': '21.305091240000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583024700, 'open': '8549.5', 'high': '8553.5', 'low': '8543.5', 'close': '8543.5', 'volume': '257329', 'turnover': '30.097248519999994'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583025000, 'open': '8543.5', 'high': '8543.5', 'low': '8525', 'close': '8525.5', 'volume': '116942', 'turnover': '13.712027460000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583025300, 'open': '8525.5', 'high': '8555', 'low': '8525.5', 'close': '8554', 'volume': '341389', 'turnover': '39.94865581999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583025600, 'open': '8554', 'high': '8571', 'low': '8554', 'close': '8566.5', 'volume': '133436', 'turnover': '15.578917469999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583025900, 'open': '8566.5', 'high': '8574.5', 'low': '8554.5', 'close': '8573.5', 'volume': '235933', 'turnover': '27.557187410000004'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583026200, 'open': '8573.5', 'high': '8573.5', 'low': '8550', 'close': '8567.5', 'volume': '137709', 'turnover': '16.08172453'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583026500, 'open': '8567.5', 'high': '8591.5', 'low': '8567.5', 'close': '8591.5', 'volume': '179632', 'turnover': '20.93158715'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583026800, 'open': '8591.5', 'high': '8606.5', 'low': '8591.5', 'close': '8605.5', 'volume': '301558', 'turnover': '35.072585059999994'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583027100, 'open': '8605.5', 'high': '8635', 'low': '8605.5', 'close': '8620.5', 'volume': '512260', 'turnover': '59.428111639999976'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583027400, 'open': '8620.5', 'high': '8624', 'low': '8611.5', 'close': '8624', 'volume': '154261', 'turnover': '17.900437970000016'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583027700, 'open': '8624', 'high': '8654.5', 'low': '8624', 'close': '8652.5', 'volume': '172758', 'turnover': '19.97909065'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583028000, 'open': '8652.5', 'high': '8677', 'low': '8652', 'close': '8659', 'volume': '717346', 'turnover': '82.78364766000006'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583028300, 'open': '8659', 'high': '8662', 'low': '8641.5', 'close': '8647', 'volume': '269490', 'turnover': '31.163979259999987'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583028600, 'open': '8647', 'high': '8651', 'low': '8635.5', 'close': '8642', 'volume': '300993', 'turnover': '34.81731623999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583028900, 'open': '8642', 'high': '8654.5', 'low': '8634', 'close': '8634', 'volume': '233768', 'turnover': '27.013901609999998'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583029200, 'open': '8634', 'high': '8645', 'low': '8629', 'close': '8645', 'volume': '171912', 'turnover': '19.913103319999994'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583029500, 'open': '8645', 'high': '8652.5', 'low': '8636.5', 'close': '8652.5', 'volume': '476988', 'turnover': '55.154581439999994'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583029800, 'open': '8652.5', 'high': '8652.5', 'low': '8646.5', 'close': '8646.5', 'volume': '134719', 'turnover': '15.570334590000005'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583030100, 'open': '8646.5', 'high': '8649', 'low': '8632', 'close': '8648.5', 'volume': '235037', 'turnover': '27.19681255'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583030400, 'open': '8648.5', 'high': '8649', 'low': '8636.5', 'close': '8640', 'volume': '306655', 'turnover': '35.47373506999998'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583030700, 'open': '8640', 'high': '8655', 'low': '8640', 'close': '8652', 'volume': '206509', 'turnover': '23.872400059999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583031000, 'open': '8652', 'high': '8655.5', 'low': '8637.5', 'close': '8642', 'volume': '146959', 'turnover': '16.99728428'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583031300, 'open': '8642', 'high': '8645.5', 'low': '8638.5', 'close': '8638.5', 'volume': '172122', 'turnover': '19.921863010000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583031600, 'open': '8638.5', 'high': '8639.5', 'low': '8634', 'close': '8634.5', 'volume': '202565', 'turnover': '23.451919380000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583031900, 'open': '8634.5', 'high': '8650.5', 'low': '8631.5', 'close': '8650.5', 'volume': '180443', 'turnover': '20.885778300000002'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583032200, 'open': '8650.5', 'high': '8660.5', 'low': '8650.5', 'close': '8653', 'volume': '177572', 'turnover': '20.519047959999995'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583032500, 'open': '8653', 'high': '8656', 'low': '8651.5', 'close': '8656', 'volume': '147308', 'turnover': '17.02582695'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583032800, 'open': '8656', 'high': '8668.5', 'low': '8656', 'close': '8658.5', 'volume': '162443', 'turnover': '18.747695219999994'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583033100, 'open': '8658.5', 'high': '8662.5', 'low': '8655', 'close': '8662.5', 'volume': '203927', 'turnover': '23.546707900000005'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583033400, 'open': '8662.5', 'high': '8668', 'low': '8654.5', 'close': '8656', 'volume': '60239', 'turnover': '6.952743250000003'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583033700, 'open': '8656', 'high': '8659.5', 'low': '8648', 'close': '8648', 'volume': '44499', 'turnover': '5.140518839999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583034000, 'open': '8648', 'high': '8648.5', 'low': '8641.5', 'close': '8642', 'volume': '32982', 'turnover': '3.81545612'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583034300, 'open': '8642', 'high': '8642', 'low': '8635.5',
    'close': '8635.5', 'volume': '83323', 'turnover': '9.644036279999998'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583034600, 'open': '8635.5', 'high': '8643', 'low': '8628.5', 'close': '8631.5', 'volume': '257894', 'turnover': '29.86659457'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583034900, 'open': '8631.5', 'high': '8634', 'low': '8619', 'close': '8624', 'volume': '241538', 'turnover': '27.994154689999995'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583035200, 'open': '8624', 'high': '8630', 'low': '8623.5', 'close': '8625', 'volume': '165653', 'turnover': '19.203064840000007'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583035500, 'open': '8625', 'high': '8625', 'low': '8620', 'close': '8620', 'volume': '207233', 'turnover': '24.03171928999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583035800, 'open': '8620', 'high': '8620', 'low': '8598.5', 'close': '8599', 'volume': '143139', 'turnover': '16.637996589999986'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583036100, 'open': '8599', 'high': '8599', 'low': '8584', 'close': '8586', 'volume': '232990', 'turnover': '27.121626640000006'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583036400, 'open': '8586', 'high': '8586', 'low': '8575', 'close': '8583', 'volume': '276255', 'turnover': '32.198711339999996'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583036700, 'open': '8583', 'high': '8583', 'low': '8572', 'close': '8572.5', 'volume': '321351', 'turnover': '37.46593433000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583037000, 'open': '8572.5', 'high': '8591', 'low': '8572', 'close': '8590', 'volume': '315038', 'turnover': '36.71587777000002'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583037300, 'open': '8590', 'high': '8590', 'low': '8569', 'close': '8570', 'volume': '121618', 'turnover': '14.176260190000004'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583037600, 'open': '8570', 'high': '8582.5', 'low': '8570', 'close': '8581.5', 'volume': '111634', 'turnover': '13.00802272'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583037900, 'open': '8581.5', 'high': '8588.5', 'low': '8581.5', 'close': '8588.5', 'volume': '130010', 'turnover': '15.147048659999994'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583038200, 'open': '8588.5', 'high': '8593.5', 'low': '8582.5', 'close': '8593', 'volume': '141301', 'turnover': '16.45164374'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583038500, 'open': '8593', 'high': '8598', 'low': '8583.5', 'close': '8583.5', 'volume': '18745', 'turnover': '2.18223455'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583038800, 'open': '8583.5', 'high': '8583.5', 'low': '8582', 'close': '8582', 'volume': '27649', 'turnover': '3.2217301899999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583039100, 'open': '8582', 'high': '8582', 'low': '8582', 'close': '8582', 'volume': '2', 'turnover': '0.00023304'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583039400, 'open': '8582', 'high': '8582', 'low': '8563', 'close': '8563', 'volume': '42668', 'turnover': '4.974284429999997'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583039700, 'open': '8563', 'high': '8565', 'low': '8556.5', 'close': '8562.5', 'volume': '70221', 'turnover': '8.19946045'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583040000, 'open': '8562.5', 'high': '8564', 'low': '8557', 'close': '8557', 'volume': '231718', 'turnover': '27.06632365'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583040300, 'open': '8557', 'high': '8557', 'low': '8545', 'close': '8554', 'volume': '218884', 'turnover': '25.59290607000001'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583040600, 'open': '8554', 'high': '8573.5', 'low': '8554', 'close': '8573', 'volume': '243524', 'turnover': '28.41452038'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583040900, 'open': '8573', 'high': '8575', 'low': '8562', 'close': '8575', 'volume': '129180', 'turnover': '15.073306389999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583041200, 'open': '8575', 'high': '8576.5', 'low': '8570.5', 'close': '8571', 'volume': '167144', 'turnover': '19.498366940000004'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583041500, 'open': '8571', 'high': '8582.5', 'low': '8566.5', 'close': '8582.5', 'volume': '84319', 'turnover': '9.832102080000002'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583041800, 'open': '8582.5', 'high': '8582.5', 'low': '8580.5', 'close': '8582.5', 'volume': '92716', 'turnover': '10.80362352'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583042100, 'open': '8582.5', 'high': '8592', 'low': '8582.5', 'close': '8591', 'volume': '378476', 'turnover': '44.059930949999995'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583042400, 'open': '8591', 'high': '8591.5', 'low': '8580', 'close': '8580.5', 'volume': '312018', 'turnover': '36.34890618'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583042700, 'open': '8580.5', 'high': '8581', 'low': '8569.5', 'close': '8574', 'volume': '101682', 'turnover': '11.860093549999998'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583043000, 'open': '8574', 'high': '8574', 'low': '8561.5', 'close': '8562.5', 'volume': '247267', 'turnover': '28.864790580000005'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583043300, 'open': '8562.5', 'high': '8581.5', 'low': '8562', 'close': '8580', 'volume': '207077', 'turnover': '24.14602761'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583043600, 'open': '8580', 'high': '8585.5', 'low': '8574.5', 'close': '8574.5', 'volume': '176748', 'turnover': '20.605483639999996'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583043900, 'open': '8574.5', 'high': '8583', 'low': '8573', 'close': '8573', 'volume': '130624', 'turnover': '15.222748829999999'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583044200, 'open': '8573', 'high': '8573', 'low': '8539', 'close': '8555', 'volume': '82168', 'turnover': '9.608780140000002'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583044500, 'open': '8555', 'high': '8557', 'low': '8539', 'close': '8540.5', 'volume': '90500', 'turnover': '10.581716229999996'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583044800, 'open': '8540.5', 'high': '8548', 'low': '8535', 'close': '8543.5', 'volume': '132119', 'turnover': '15.468249279999998'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583045100, 'open': '8543.5', 'high': '8550', 'low': '8543.5', 'close': '8545.5', 'volume': '153775', 'turnover': '17.991104629999995'}, {'symbol': 'BTCUSD', 'interval': '5', 'open_time': 1583045400, 'open': '8545.5', 'high': '8561', 'low': '8535.5', 'close': '8561', 'volume': '182087', 'turnover': '21.290176379999995'}], 
    'time_now': '1583045597.182438'}

import ta
import pandas as pd
from strategy import Strategy
from backtest import Backtester
from exchange import BybitExchange
import optuna
from optuna.samplers import TPESampler, RandomSampler, GridSampler


import time
from datetime import datetime

import configparser

def update_config_file(best_params):
    config = configparser.ConfigParser()
    config['DEFAULT'] = {
        'WT_OPEN_LONG_THRESHOLD' : best_params.get('wt_open_long'),
        'WT_OPEN_SHORT_THRESHOLD' : best_params.get('wt_open_short'),
        'MFI_OPEN_THRESHOLD' : best_params.get('mfi_open'),
        'MFI_CLOSE_THRESHOLD' : best_params.get('mfi_close'),
        'WT_EXIT_LONG_THRESHOLD' : best_params.get('wt_exit_long'),
        'WT_EXIT_SHORT_THRESHOLD' : best_params.get('wt_exit_short'),
    
    }
    with open('config.ini', 'w') as configfile:
      config.write(configfile)

if __name__ == '__main__':

    config = configparser.ConfigParser()
    config.read('keys.ini')

    api_key = config['TESTNET']['API_KEY']
    private_key = config['TESTNET']['API_SECRET']

    exchange = BybitExchange(test=False, api_key=api_key, private_key=private_key)

    n_windows = 6
    window_size = 144
    n_klines = n_windows * window_size
    n_train = 4

    result = exchange.get_klines(symbol="BTCUSD", interval="5", limit=n_klines)

    train_set_threshold = n_train * window_size

    train_set = result[:train_set_threshold]
    validation_set = result[train_set_threshold:]

    print('hello')

    param_config = configparser.ConfigParser()
    param_config.read('config.ini')
    cur_wt_open_long = float(param_config['DEFAULT']['WT_OPEN_LONG_THRESHOLD'])
    new_wt_open_long_max = min(cur_wt_open_long+40, 100)
    new_wt_open_long_min = max(cur_wt_open_long-40, -100)
    cur_wt_open_short = float(param_config['DEFAULT']['WT_OPEN_SHORT_THRESHOLD'])
    new_wt_open_short_max = min(cur_wt_open_short+40, 100)
    new_wt_open_short_min = max(cur_wt_open_short-40, -100)
    cur_mfi_open = float(param_config['DEFAULT']['MFI_OPEN_THRESHOLD'])
    new_mfi_open_max = min(cur_mfi_open+10, 40)
    new_mfi_open_min = max(cur_mfi_open-10, -40)
    cur_mfi_close = float(param_config['DEFAULT']['MFI_CLOSE_THRESHOLD'])
    new_mfi_close_max = min(cur_mfi_close+10, 40)
    new_mfi_close_min = max(cur_mfi_close-10, -40)
    cur_wt_exit_long = float(param_config['DEFAULT']['WT_EXIT_LONG_THRESHOLD'])
    new_wt_exit_long_max = min(cur_wt_exit_long+40, 100)
    new_wt_exit_long_min = max(cur_wt_exit_long-40, -100)
    cur_wt_exit_short = float(param_config['DEFAULT']['WT_EXIT_SHORT_THRESHOLD'])
    new_wt_exit_short_max = min(cur_wt_exit_short+40, 100)
    new_wt_exit_short_min = max(cur_wt_exit_short-40, -100)

    def objective(trial):
        test_strategy = Strategy(
            wt_open_long = trial.suggest_uniform('wt_open_long', new_wt_open_long_min, new_wt_open_long_max),
            wt_open_short = trial.suggest_uniform('wt_open_short', new_wt_open_short_min, new_wt_open_short_max),
            mfi_open = trial.suggest_uniform('mfi_open', new_mfi_open_min, new_mfi_open_max),
            mfi_close = trial.suggest_uniform('mfi_close', new_mfi_close_min, new_mfi_close_max),
            wt_exit_long = trial.suggest_uniform('wt_exit_long', new_wt_exit_long_min, new_wt_exit_long_max),
            wt_exit_short = trial.suggest_uniform('wt_exit_short', new_wt_exit_short_min, new_wt_exit_short_max),
        )

        test_strategy.load_klines(data=train_set)
    
        backtester = Backtester(strategy=test_strategy, stake_percent=0.05, pyramiding=12)
        # backtester.print_report()
        return (-1 * backtester.get_sharpe_ratio())


    # study = optuna.create_study()
    # study.optimize(objective, n_trials=30)
    # print(study.best_params)

    while True:
        study = optuna.create_study()
        study.optimize(objective, n_trials=30)
        print(study.best_params)
        validation_strat = Strategy(
                wt_open_long = study.best_params.get('wt_open_long'),
                wt_open_short = study.best_params.get('wt_open_short'),
                mfi_open = study.best_params.get('mfi_open'),
                mfi_close = study.best_params.get('mfi_close'),
                wt_exit_long = study.best_params.get('wt_exit_long'),
                wt_exit_short = study.best_params.get('wt_exit_short'),
        )
        validation_strat.load_klines(data=validation_set)
        backtester = Backtester(strategy=validation_strat, stake_percent=0.05, pyramiding=12)
        print(f"Validation report:::")
        backtester.print_report()
        print(f"sharpe ratio: {backtester.get_sharpe_ratio()}")

        if backtester.get_sharpe_ratio() > 0.05:
            print(f"Found successful strategy on the validation set.")
            print(study.best_params)
            break
    

    # test_strategy = Strategy(
    #         wt_open_long = study.best_params.get('wt_open_long'),
    #         wt_open_short = study.best_params.get('wt_open_short'),
    #         mfi_open = study.best_params.get('mfi_open'),
    #         mfi_close = study.best_params.get('mfi_close'),
    #         wt_exit_long = study.best_params.get('wt_exit_long'),
    #         wt_exit_short = study.best_params.get('wt_exit_short'),
    # )
    # test_strategy.load_klines(data=validation_set)
    # backtester = Backtester(strategy=test_strategy, stake_percent=0.05, pyramiding=12)
    # print(f"Final test set report:::")
    # backtester.print_report()
    # print(f"sharpe ratio: {backtester.get_sharpe_ratio()}")

    update_config_file(study.best_params)